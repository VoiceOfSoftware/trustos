

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Settle &mdash; trustos master documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Trust" href="trust.html" />
    <link rel="prev" title="Token" href="token.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          


          
            <a href="index.html" class="icon icon-home"> trustos
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

<br>
<a style="width:100%;" href="index.html">
    <h1 style="color: white; font-size:220%; margin-bottom:2px;">TrustOS</h1>
</a>
<img style="background:none; margin: auto;  width:30%; height:95%;" alt="Telefónica"
    src="_static/images/telefonica_white.png" />

<!-- 
<a href="https://github.com/hyperledger/fabric"></a>
&nbsp;<a href="https://stackoverflow.com/questions/tagged/hyperledger-fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="StackOverflow" src="_static/images/stackoverflow_button.png"/></a>
&nbsp;<a href="https://chat.hyperledger.org"><img style="padding: 0px; margin: auto auto auto auto;" alt="Rocket Chat" src="_static/images/rocketchat_button.png"/></a>
&nbsp;<a href="https://www.youtube.com/playlist?list=PL0MZ85B_96CH7wvtrRzV7SvtRY0sI0DEg"><img style="padding: 0px; margin: auto auto auto auto;" alt="Youtube Channel" src="_static/images/youtube_button.png"/></a> -->


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="track.html">Track</a></li>
<li class="toctree-l1"><a class="reference internal" href="token.html">Token</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Settle</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#api-specification">API Specification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Settle</a></li>
<li class="toctree-l3"><a class="reference internal" href="#methods">Methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#post-settlement-create">POST   -   <code class="docutils literal notranslate"><span class="pre">/settlement/create/</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-settlement-settleid">GET   -   <code class="docutils literal notranslate"><span class="pre">/settlement/{settleId}</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-settlement-settleid-history">GET   -   <code class="docutils literal notranslate"><span class="pre">/settlement/{settleId}/history</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-settlement-settleid-settled">GET   -   <code class="docutils literal notranslate"><span class="pre">/settlement/{settleId}/settled</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#post-settlement-settleid-update">POST   -   <code class="docutils literal notranslate"><span class="pre">/settlement/{settleId}/update</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#post-settlement-settleid-settle">POST  -   <code class="docutils literal notranslate"><span class="pre">/settlement/{settleId}/settle</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#post-settlement-settleid-clear">POST  -   <code class="docutils literal notranslate"><span class="pre">/settlement/{settleId}/clear</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#architecture-of-the-project">Architecture of the project</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-we-run-the-application">How we run the application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-the-application">Testing the Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#errors-management">Errors management</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="trust.html">Trust</a></li>
<li class="toctree-l1"><a class="reference internal" href="id.html">TrustID</a></li>
<li class="toctree-l1"><a class="reference internal" href="use_cases.html">Use cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="demos.html">Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">trustos</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Settle</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/settle.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="settle">
<h1>Settle<a class="headerlink" href="#settle" title="Permalink to this headline">¶</a></h1>
<p>This API generates a general structure to perform the settlement of records. The API allows
the settlement of a great gamut of record structures, aggregations and settlement operations.
Currently two <code class="docutils literal notranslate"><span class="pre">aggregation</span></code> and <code class="docutils literal notranslate"><span class="pre">settlement</span></code> operations are implemented, but further
settlement and aggregation operations will be implemented in future versions. You can contact
our development team through the Issues to ask for new settlement and aggregation operations
to fit your use case.</p>
<div class="section" id="api-specification">
<h2>API Specification<a class="headerlink" href="#api-specification" title="Permalink to this headline">¶</a></h2>
<p>An abstraction API with all the settlement functionalities.</p>
<div class="section" id="id1">
<h3>Settle<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>A settlement structure has the following parameters:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">settleid</span></code> :  <code class="docutils literal notranslate"><span class="pre">&lt;string&gt;</span></code>    - Unique identifier of the settlement structure</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aggregates</span></code> : <code class="docutils literal notranslate"><span class="pre">&lt;string</span> <span class="pre">&gt;</span></code>  - Variables used as input for the aggregation operation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">primaryKey</span></code>    : <code class="docutils literal notranslate"><span class="pre">&lt;string&gt;</span></code> - Primary key used to aggregate metrics, build the common record and make the settlement.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aggregationType</span> <span class="pre">[1CDR</span> <span class="pre">/</span> <span class="pre">mcCounter]</span></code> : <code class="docutils literal notranslate"><span class="pre">&lt;string</span> <span class="pre">&gt;</span></code> - Aggregation operation. This operation is triggered every time a new record is updated to the system.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">settlementType</span> <span class="pre">[1CDR</span> <span class="pre">/</span> <span class="pre">none]</span></code> : <code class="docutils literal notranslate"><span class="pre">&lt;string&gt;</span></code> - Settlement operation. It is triggered whenever a settlement operation is requested. It takes
the status of the common record and generates a settled structure. The aggregation variables are cleared for a new round of settlement.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">record</span></code> : <code class="docutils literal notranslate"><span class="pre">&lt;string&gt;</span></code> - Sample record used to define the structure of records in the settlement structure. Also used as the
main variable used to upload records.</p></li>
</ul>
<details>
  <summary><em><strong>Sample structure</strong></em> (Click to expand)</summary><div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;settleid&quot;</span><span class="o">:</span> <span class="s2">&quot;settle&quot;</span><span class="p">,</span>
  <span class="s2">&quot;aggregates&quot;</span><span class="o">:</span> <span class="s2">&quot;[&#39;msg&#39;]&quot;</span><span class="p">,</span>
  <span class="s2">&quot;aggregationType&quot;</span><span class="o">:</span> <span class="s2">&quot;mcCounter&quot;</span><span class="p">,</span>
  <span class="s2">&quot;primaryKey&quot;</span><span class="o">:</span> <span class="s2">&quot;app&quot;</span><span class="p">,</span>
  <span class="s2">&quot;settlementType&quot;</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
  <span class="s2">&quot;record&quot;</span><span class="o">:</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
</details>
<br></div>
<div class="section" id="methods">
<h3>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h3>
<p><img alt="SettleAPI methods" src="_images/settle_swagger.png" /></p>
<details>
  <summary><em><strong>Settlement methods</strong></em> (Click to expand)</summary><hr class="docutils" />
<div class="section" id="post-settlement-create">
<h4>POST   -   <code class="docutils literal notranslate"><span class="pre">/settlement/create/</span></code><a class="headerlink" href="#post-settlement-create" title="Permalink to this headline">¶</a></h4>
<p>Creates a new settlement structure.</p>
<p><em>Input</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">settleid</span></code> :  <code class="docutils literal notranslate"><span class="pre">&lt;string&gt;</span></code>    - Unique identifier of the settlement structure</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aggregates</span></code> : <code class="docutils literal notranslate"><span class="pre">&lt;string</span> <span class="pre">&gt;</span></code>  - Variables used as input for the aggregation operation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">primaryKey</span></code>    : <code class="docutils literal notranslate"><span class="pre">&lt;string&gt;</span></code> - Primary key used to aggregate metrics, build the common record and make the settlement.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aggregationType</span> <span class="pre">[1CDR</span> <span class="pre">/</span> <span class="pre">mcCounter]</span></code> : <code class="docutils literal notranslate"><span class="pre">&lt;string</span> <span class="pre">&gt;</span></code> - Aggregation operation. This operation is triggered every time a new record is updated to the system.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">settlementType</span> <span class="pre">[1CDR</span> <span class="pre">/</span> <span class="pre">none]</span></code> : <code class="docutils literal notranslate"><span class="pre">&lt;string&gt;</span></code> - Settlement operation. It is triggered whenever a settlement operation is requested. It takes
the status of the common record and generates a settled structure. The aggregation variables are cleared for a new round of settlement.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">record</span></code> : <code class="docutils literal notranslate"><span class="pre">&lt;string&gt;</span></code> - Sample record used to define the structure of records in the settlement structure. Also used as the
main variable used to upload records.</p></li>
</ul>
<details>
  <summary><em><strong>Sample structure</strong></em> (Click to expand)</summary><div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;record&quot;</span><span class="o">:</span> <span class="p">{</span>
   <span class="s2">&quot;app&quot;</span><span class="o">:</span>  <span class="s2">&quot;4240e1f7-d287-46a9-8b92-f112510bd9f7&quot;</span><span class="p">,</span>
   <span class="s2">&quot;op&quot;</span><span class="o">:</span>  <span class="s2">&quot;CREATE&quot;</span><span class="p">,</span>
   <span class="s2">&quot;corr&quot;</span><span class="o">:</span>  <span class="s2">&quot;AUS-b8727fc3-dfc1-4c37-b6d6-d6897ed10ddd&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;aggregates&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;op&quot;</span><span class="p">],</span>
  <span class="s2">&quot;aggregationType&quot;</span><span class="o">:</span> <span class="s2">&quot;mcCounter&quot;</span><span class="p">,</span>
  <span class="s2">&quot;settlementType&quot;</span><span class="o">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
  <span class="s2">&quot;settleid&quot;</span><span class="o">:</span> <span class="s2">&quot;testing&quot;</span><span class="p">,</span>
  <span class="s2">&quot;primaryKey&quot;</span><span class="o">:</span> <span class="s2">&quot;app&quot;</span>
 <span class="p">}</span>
</pre></div>
</div>
</details><p><em>Output</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">settlementObject</span></code>    :  <code class="docutils literal notranslate"><span class="pre">&lt;json&gt;</span></code></p></li>
</ul>
<details>
  <summary><em><strong>Sample structure</strong></em> (Click to expand)</summary><div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;output&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;aggregationMetrics&quot;</span><span class="o">:</span> <span class="p">[</span>
      <span class="s2">&quot;op&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;aggregationType&quot;</span><span class="o">:</span> <span class="s2">&quot;mcCounter&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lastSettlement&quot;</span><span class="o">:</span> <span class="mi">1565172714</span><span class="p">,</span>
    <span class="s2">&quot;lastUpdate&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;operation&quot;</span><span class="o">:</span> <span class="s2">&quot;Create&quot;</span><span class="p">,</span>
      <span class="s2">&quot;timestamp&quot;</span><span class="o">:</span> <span class="mi">1565172714</span><span class="p">,</span>
      <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="s2">&quot;test:org1MSP&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;primaryKey&quot;</span><span class="o">:</span> <span class="s2">&quot;app&quot;</span><span class="p">,</span>
    <span class="s2">&quot;settleid&quot;</span><span class="o">:</span> <span class="s2">&quot;testing&quot;</span><span class="p">,</span>
    <span class="s2">&quot;settlementType&quot;</span><span class="o">:</span> <span class="s2">&quot;none&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</details></div>
<hr class="docutils" />
<div class="section" id="get-settlement-settleid">
<h4>GET   -   <code class="docutils literal notranslate"><span class="pre">/settlement/{settleId}</span></code><a class="headerlink" href="#get-settlement-settleid" title="Permalink to this headline">¶</a></h4>
<p>Gets the current status of a settlement structure. It shows the current
status of aggregates.</p>
<p><em>Input</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">settleId</span></code> :  <code class="docutils literal notranslate"><span class="pre">&lt;string&gt;</span></code></p></li>
</ul>
<p><em>Output</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">newSettlementObject</span></code>    :  <code class="docutils literal notranslate"><span class="pre">&lt;json&gt;</span></code></p></li>
</ul>
<details>
  <summary><em><strong>Sample structure</strong></em> (Click to expand)</summary><div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;output&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;aggregates&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;2344240e1f7-d287-46a9-8b92-f1232342431&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;op&quot;</span><span class="o">:</span> <span class="s2">&quot;2&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;4240e1f7-d287-46a9-8b92-f112510bd9f7&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;op&quot;</span><span class="o">:</span> <span class="s2">&quot;1&quot;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;aggregationMetrics&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;op&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;aggregationType&quot;</span><span class="o">:</span> <span class="s2">&quot;mcCounter&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lastSettlement&quot;</span><span class="o">:</span> <span class="mi">1565172714</span><span class="p">,</span>
        <span class="s2">&quot;lastUpdate&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;operation&quot;</span><span class="o">:</span> <span class="s2">&quot;Update&quot;</span><span class="p">,</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="o">:</span> <span class="mi">1565172892</span><span class="p">,</span>
            <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="s2">&quot;test:org1MSP&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;primaryKey&quot;</span><span class="o">:</span> <span class="s2">&quot;app&quot;</span><span class="p">,</span>
        <span class="s2">&quot;settleid&quot;</span><span class="o">:</span> <span class="s2">&quot;testing&quot;</span><span class="p">,</span>
        <span class="s2">&quot;settlementType&quot;</span><span class="o">:</span> <span class="s2">&quot;none&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</details></div>
<hr class="docutils" />
<div class="section" id="get-settlement-settleid-history">
<h4>GET   -   <code class="docutils literal notranslate"><span class="pre">/settlement/{settleId}/history</span></code><a class="headerlink" href="#get-settlement-settleid-history" title="Permalink to this headline">¶</a></h4>
<p>Gets the history of changes over a settlement structure according to updated records.</p>
<p><em>Input</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">settleId</span></code> :  <code class="docutils literal notranslate"><span class="pre">&lt;string&gt;</span></code></p></li>
</ul>
<p><em>Output</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">newSettlementObject</span></code>    :  <code class="docutils literal notranslate"><span class="pre">&lt;json&gt;</span></code></p></li>
</ul>
<details>
  <summary><em><strong>Sample structure</strong></em> (Click to expand)</summary><div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;output&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;aggregates&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;2344240e1f7-d287-46a9-8b92-f1232342431&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;op&quot;</span><span class="o">:</span> <span class="s2">&quot;2&quot;</span>
                <span class="p">},</span>
                <span class="s2">&quot;4240e1f7-d287-46a9-8b92-f112510bd9f7&quot;</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s2">&quot;op&quot;</span><span class="o">:</span> <span class="s2">&quot;1&quot;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;aggregationMetrics&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="s2">&quot;op&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;aggregationType&quot;</span><span class="o">:</span> <span class="s2">&quot;mcCounter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lastSettlement&quot;</span><span class="o">:</span> <span class="mi">1565172714</span><span class="p">,</span>
            <span class="s2">&quot;lastUpdate&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;operation&quot;</span><span class="o">:</span> <span class="s2">&quot;Update&quot;</span><span class="p">,</span>
                <span class="s2">&quot;timestamp&quot;</span><span class="o">:</span> <span class="mi">1565172892</span><span class="p">,</span>
                <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="s2">&quot;test:org1MSP&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;primaryKey&quot;</span><span class="o">:</span> <span class="s2">&quot;app&quot;</span><span class="p">,</span>
            <span class="s2">&quot;settleid&quot;</span><span class="o">:</span> <span class="s2">&quot;testing&quot;</span><span class="p">,</span>
            <span class="s2">&quot;settlementType&quot;</span><span class="o">:</span> <span class="s2">&quot;none&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;aggregationMetrics&quot;</span><span class="o">:</span> <span class="p">[</span>
                <span class="s2">&quot;op&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;aggregationType&quot;</span><span class="o">:</span> <span class="s2">&quot;mcCounter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lastSettlement&quot;</span><span class="o">:</span> <span class="mi">1565172714</span><span class="p">,</span>
            <span class="s2">&quot;lastUpdate&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;operation&quot;</span><span class="o">:</span> <span class="s2">&quot;Create&quot;</span><span class="p">,</span>
                <span class="s2">&quot;timestamp&quot;</span><span class="o">:</span> <span class="mi">1565172714</span><span class="p">,</span>
                <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="s2">&quot;test:org1MSP&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;primaryKey&quot;</span><span class="o">:</span> <span class="s2">&quot;app&quot;</span><span class="p">,</span>
            <span class="s2">&quot;settleid&quot;</span><span class="o">:</span> <span class="s2">&quot;testing&quot;</span><span class="p">,</span>
            <span class="s2">&quot;settlementType&quot;</span><span class="o">:</span> <span class="s2">&quot;none&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</details></div>
<hr class="docutils" />
<div class="section" id="get-settlement-settleid-settled">
<h4>GET   -   <code class="docutils literal notranslate"><span class="pre">/settlement/{settleId}/settled</span></code><a class="headerlink" href="#get-settlement-settleid-settled" title="Permalink to this headline">¶</a></h4>
<p>Gets all settlements performed over a specific settleId.</p>
<p><em>Input</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">settleId</span></code> :  <code class="docutils literal notranslate"><span class="pre">&lt;string&gt;</span></code></p></li>
</ul>
<p><em>Output</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">newSettlementObject</span></code>    :  <code class="docutils literal notranslate"><span class="pre">&lt;json&gt;</span></code></p></li>
</ul>
<details>
  <summary><em><strong>Sample structure</strong></em> (Click to expand)</summary><div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;output&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;aggregates&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;2344240e1f7-d287-46a9-8b92-f1232342431&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;op&quot;</span><span class="o">:</span> <span class="s2">&quot;2&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;4240e1f7-d287-46a9-8b92-f112510bd9f7&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;op&quot;</span><span class="o">:</span> <span class="s2">&quot;1&quot;</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;timestamp&quot;</span><span class="o">:</span> <span class="mi">1565186196</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</details></div>
<hr class="docutils" />
<div class="section" id="post-settlement-settleid-update">
<h4>POST   -   <code class="docutils literal notranslate"><span class="pre">/settlement/{settleId}/update</span></code><a class="headerlink" href="#post-settlement-settleid-update" title="Permalink to this headline">¶</a></h4>
<p>It uploads a new record to a settlement structure updating
the status of aggregates according to the <code class="docutils literal notranslate"><span class="pre">aggregationType</span></code> defined
for the settling structure.</p>
<p><em>Input</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">settlementObject</span></code> :  <code class="docutils literal notranslate"><span class="pre">&lt;json&gt;</span></code></p></li>
</ul>
<details>
  <summary><em><strong>Sample structure</strong></em> (Click to expand)</summary><div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;record&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;app&quot;</span><span class="o">:</span>  <span class="s2">&quot;4240e1f7-d287-46a9-8b92-f112510bd9f7&quot;</span><span class="p">,</span>
        <span class="s2">&quot;op&quot;</span><span class="o">:</span>  <span class="s2">&quot;CREATE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;corr&quot;</span><span class="o">:</span>  <span class="s2">&quot;AUS-b8727fc3-dfc1-4c37-b6d6-d6897ed10ddd&quot;</span>
        <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;app&quot;</span><span class="o">:</span>  <span class="s2">&quot;2344240e1f7-d287-46a9-8b92-f1232342431&quot;</span><span class="p">,</span>
        <span class="s2">&quot;op&quot;</span><span class="o">:</span>  <span class="s2">&quot;CREATE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;corr&quot;</span><span class="o">:</span>  <span class="s2">&quot;AUS-b8727fc3-dfc1-4c37-b6d6-d6897ed10ddd&quot;</span>
        <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;app&quot;</span><span class="o">:</span>  <span class="s2">&quot;2344240e1f7-d287-46a9-8b92-f1232342431&quot;</span><span class="p">,</span>
        <span class="s2">&quot;op&quot;</span><span class="o">:</span>  <span class="s2">&quot;DELETE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;corr&quot;</span><span class="o">:</span>  <span class="s2">&quot;AUS-b8727fc3-dfc1-4c37-b6d6-d6897ed10ddd&quot;</span>
        <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</details><p><em>Output</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">newSettlementObject</span></code>    :  <code class="docutils literal notranslate"><span class="pre">&lt;json&gt;</span></code></p></li>
</ul>
<details>
  <summary><em><strong>Sample structure</strong></em> (Click to expand)</summary><div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;output&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;aggregates&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;2344240e1f7-d287-46a9-8b92-f1232342431&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;op&quot;</span><span class="o">:</span> <span class="s2">&quot;2&quot;</span>
      <span class="p">},</span>
      <span class="s2">&quot;4240e1f7-d287-46a9-8b92-f112510bd9f7&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;op&quot;</span><span class="o">:</span> <span class="s2">&quot;1&quot;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;aggregationMetrics&quot;</span><span class="o">:</span> <span class="p">[</span>
      <span class="s2">&quot;op&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;aggregationType&quot;</span><span class="o">:</span> <span class="s2">&quot;mcCounter&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lastSettlement&quot;</span><span class="o">:</span> <span class="mi">1565172714</span><span class="p">,</span>
    <span class="s2">&quot;lastUpdate&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;operation&quot;</span><span class="o">:</span> <span class="s2">&quot;Update&quot;</span><span class="p">,</span>
      <span class="s2">&quot;timestamp&quot;</span><span class="o">:</span> <span class="mi">1565172892</span><span class="p">,</span>
      <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="s2">&quot;test:org1MSP&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;primaryKey&quot;</span><span class="o">:</span> <span class="s2">&quot;app&quot;</span><span class="p">,</span>
    <span class="s2">&quot;settleid&quot;</span><span class="o">:</span> <span class="s2">&quot;testing&quot;</span><span class="p">,</span>
    <span class="s2">&quot;settlementType&quot;</span><span class="o">:</span> <span class="s2">&quot;none&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</details></div>
<hr class="docutils" />
<div class="section" id="post-settlement-settleid-settle">
<h4>POST  -   <code class="docutils literal notranslate"><span class="pre">/settlement/{settleId}/settle</span></code><a class="headerlink" href="#post-settlement-settleid-settle" title="Permalink to this headline">¶</a></h4>
<p>Settles a given settlement structure. It aggregates according to the
current status of aggregates and the <code class="docutils literal notranslate"><span class="pre">aggregationType</span></code> defined for the settlement
structure.</p>
<p><em>Input</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">settleId</span></code> :  <code class="docutils literal notranslate"><span class="pre">&lt;string&gt;</span></code></p></li>
</ul>
<p><em>Output</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">newSettlementObject</span></code>    :  <code class="docutils literal notranslate"><span class="pre">&lt;json&gt;</span></code></p></li>
</ul>
<details>
  <summary><em><strong>Sample structure</strong></em> (Click to expand)</summary><div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;output&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;2344240e1f7-d287-46a9-8b92-f1232342431&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;op&quot;</span><span class="o">:</span> <span class="s2">&quot;2&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;4240e1f7-d287-46a9-8b92-f112510bd9f7&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;op&quot;</span><span class="o">:</span> <span class="s2">&quot;1&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</details></div>
<hr class="docutils" />
<div class="section" id="post-settlement-settleid-clear">
<h4>POST  -   <code class="docutils literal notranslate"><span class="pre">/settlement/{settleId}/clear</span></code><a class="headerlink" href="#post-settlement-settleid-clear" title="Permalink to this headline">¶</a></h4>
<p>Clears a settlement structure. It removes the current status of the aggregates.
This may be used when unconsistent updates have been performed or errors have
been detected in the updating of records.</p>
<p><em>Input</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">settleId</span></code> :  <code class="docutils literal notranslate"><span class="pre">&lt;string&gt;</span></code></p></li>
</ul>
<p><em>Output</em></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">newSettlementObject</span></code>    :  <code class="docutils literal notranslate"><span class="pre">&lt;json&gt;</span></code></p></li>
</ul>
<details>
  <summary><em><strong>Sample structure</strong></em> (Click to expand)</summary><div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;output&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;aggregationMetrics&quot;</span><span class="o">:</span> <span class="p">[</span>
            <span class="s2">&quot;op&quot;</span>
        <span class="p">],</span>
        <span class="s2">&quot;aggregationType&quot;</span><span class="o">:</span> <span class="s2">&quot;mcCounter&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lastSettlement&quot;</span><span class="o">:</span> <span class="mi">1565186196</span><span class="p">,</span>
        <span class="s2">&quot;lastUpdate&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;operation&quot;</span><span class="o">:</span> <span class="s2">&quot;Clear&quot;</span><span class="p">,</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="o">:</span> <span class="mi">1565186640</span><span class="p">,</span>
            <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="s2">&quot;test:org1MSP&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;primaryKey&quot;</span><span class="o">:</span> <span class="s2">&quot;app&quot;</span><span class="p">,</span>
        <span class="s2">&quot;settleid&quot;</span><span class="o">:</span> <span class="s2">&quot;testing&quot;</span><span class="p">,</span>
        <span class="s2">&quot;settlementType&quot;</span><span class="o">:</span> <span class="s2">&quot;none&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</details>
</details>
<br></div>
</div>
</div>
<div class="section" id="architecture-of-the-project">
<h2>Architecture of the project<a class="headerlink" href="#architecture-of-the-project" title="Permalink to this headline">¶</a></h2>
<p>The project is based on the open-source programming language: Golang. An abstraction of its skeleton is depicted in the diagram below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>coren-tokenapi
├── api
      ├── handler           // HTTP logic
      ├── model             // models used by the application
      ├── service           // Usecases logic
      ├── util              // Tools used by the application
          ├── log           // Logger tool
          ├── http          // Http util
          └── Config        // Tool to load the configuration from yaml files
      └── app.go            // Router application
├── config
      └── config.yaml       // Config file
├── docs
      └── docs.go           // Swagger doc file
├── postman                 // Postman collection and environment to test the API
      ├── collection    
      └── environment
├── vendor                  // Package discovery folder
├── docker-compose.yaml     // Instructions to build docker container
├── Dockerfile              // Instructions to build docker image
├── init.sh                 // Script with global environment variables
└── main.go                 // Main app
</pre></div>
</div>
</div>
<div class="section" id="how-we-run-the-application">
<h2>How we run the application<a class="headerlink" href="#how-we-run-the-application" title="Permalink to this headline">¶</a></h2>
<p>As you could see in the <a class="reference external" href="architecture.html">Architecture</a> module, all the applications are running on cloud. Through Kubernetes orchestration system the application deployment, scaling and management is an easy and automated task.</p>
</div>
<div class="section" id="testing-the-application">
<h2>Testing the Application<a class="headerlink" href="#testing-the-application" title="Permalink to this headline">¶</a></h2>
<p>In postman folder there are the collection and environment to interact and test with the API methods. It is only needed to import them into postman application and know to use the coren-settleapi module</p>
<p>Also you can download the files in the links below:</p>
<p><a href="_static/settleapi.collection.json" download> - Postman collection</a>
<br>
<a href="_static/environment.json" download> - Postman environment</a></p>
</div>
<div class="section" id="errors-management">
<h2>Errors management<a class="headerlink" href="#errors-management" title="Permalink to this headline">¶</a></h2>
<p>Settle API errors are managed through the following nomenclature <strong>SETTLE-XX</strong> which corresponds to:<br></p>
<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top}
.tg .tg-0lax{text-align:left;vertical-align:top}
</style><table class="tg">
  <tr>
    <th class="tg-0pky">Code</th>
    <th class="tg-0pky">Description</th>
  </tr>
  <tr>
    <td class="tg-0pky">SETTLE-00</td>
    <td class="tg-0pky">Service is down</td>
  </tr>
  <tr>
    <td class="tg-0pky">SETTLE-01</td>
    <td class="tg-0pky">Error parsing any data structure</td>
  </tr>
  <tr>
    <td class="tg-0lax">SETTLE-02</td>
    <td class="tg-0lax">Error of some kind of functionality</td>
  </tr>
</table><br></div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="trust.html" class="btn btn-neutral float-right" title="Trust" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="token.html" class="btn btn-neutral" title="Token" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <!-- <div role="contentinfo">
    <p>
        &copy; Copyright Telefónica 2020.

    </p>
  </div> -->
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>